<%- include("header.ejs") %>

<h1>Knowledge Base</h1>

<!-- Sökformulär -->
<form method="GET" action="/knowledge-base" class="form">
    <label for="search" class="form-label">Search Articles</label>
    <input type="text" name="search" placeholder="Search articles" class="form-input" />
    <button type="submit" class="form-button">Search</button>
</form>

<!-- Länk för att skapa en ny artikel, visas endast för agenter -->
<% if (req.oidc.user && req.oidc.user['https://ticketsystem.com/roles'].includes('agent')) { %>
    <div style="text-align: right; margin-top: 20px;">
        <a href="/knowledge-base/create" class="button">Create New Article</a>
    </div>
<% } %>



<!-- Lista över artiklar utan länk på titeln -->
<div class="knowledge-base-container">
    <% articles.forEach(function(article) { %>
        <div class="knowledge-box">
            <h3><%= article.title %></h3> <!-- Titel utan länk -->
            <p><%= article.content.substring(0, 100) %>...</p> <!-- Visar en kort sammanfattning -->

            <!-- Ta bort-knapp för agenter -->
            <% if (req.oidc.user && req.oidc.user['https://ticketsystem.com/roles'].includes('agent')) { %>
                <form method="POST" action="/knowledge-base/<%= article.id %>/delete" style="display:inline;">
                    <button type="submit" class="delete-button" onclick="return confirm('Are you sure you want to delete this article?')">Delete</button>
                </form>
            <% } %>
        </div>
    <% }) %>
</div>


<%- include("footer.ejs") %>

