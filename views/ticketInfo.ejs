<%- include("header.ejs") %>

<div class="ticket-details">
    <!-- Ticket Title and Description -->
    <h1><%= ticket[0].title %></h1>
    <p><%= ticket[0].description %></p>
    
    <div class="ticket-meta">
        <p>Category: <%= ticket[0].category_name %></p>
        
        <% if (ticket[0].files) { %>
            <a href="/uploads/<%= ticket[0].files %>" class="download-link">Download attached file</a>
        <% } %>
    </div>
    
    <!-- Assigned Agent -->
    <div class="assigned-agent">
        <p><strong>Assigned Agent:</strong> 
            <% if (ticket[0].agent_name) { %>
                <%= ticket[0].agent_name %>
            <% } else { %>
                Not yet assigned
            <% } %>
        </p>
    </div>

    <!-- Status Update Form -->
    <form method="POST" action="/ticket/<%= ticket[0].id %>/status" class="status-form">
        <label for="status">Change Status:</label>
        <select name="status" id="status">
            <% statuses.forEach(function(status) { %>
                <option value="<%= status.id %>" <%= ticket[0].status_id == status.id ? 'selected' : '' %>>
                    <%= status.name %>
                </option>
            <% }) %>
        </select>
        <button type="submit" class="status-button">Update Status</button>
    </form>
    
    <!-- Comments Section -->
    <div class="comments-section">
        <% ticket.forEach(function(row) { %>
            <% if (row.comment) { %>
                <div class="comment">
                    <p><strong><%= row.commenter_name %></strong> commented on <%= row.comment_date %>:</p>
                    <p><%= row.comment %></p>
                </div>
            <% } %>
        <% }) %>
    </div>

    <!-- Add Comment Form -->
    <div class="add-comment">
        <h2>Add a Comment</h2>
        <form method="POST" action="/ticket/<%= ticket[0].id %>/add-comment">
            <textarea name="comment" placeholder="Add your comment..." required></textarea>
            <button type="submit" class="comment-button">Add Comment</button>
        </form>
    </div>
</div>

<%- include("footer.ejs") %>
